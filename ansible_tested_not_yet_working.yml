


  - name: ensure VLANs 2-40 and 99 exist on all switches
    nxos_vlan: vlan_range="2-40,99" state=present host={{ inventory_hostname }} username=admin password=C1sco123! transport=cli


  - name: config VLANs names for a few VLANs
    nxos_vlan: vlan_id={{ item.vid }} name={{ item.name }} host={{ inventory_hostname }} state=present username=taruch password=C1sco123! transport=nxapi
    with_items:
      - { vid: 2, name: MASH }
      - { vid: 3, name: MASH }
      - { vid: 4, name: MASH }
      - { vid: 20, name: MASH }
      - { vid: 99, name: MASH }


  # Config a switchport to be a trunk interface with native vlan 10 and carriers vlan 2-100
  - name: set switchport interface
    nxos_switchport:
      host: "{{ inventory_hostname }}"
      interface: Ethernet1/1
      mode: trunk
      native_vlan: 3
      trunk_vlans: 21-24
      username: taruch
      password: C1sco123!



  #- name: Removing vlans
  #  nxos_vlan:
  #    provider: "{{ nxos_provider }}"
  #    vlan_id: "{{ item }}"
  #  with_items: "{{ updated_vlan_list | difference(vlan_list) }}"



    - name: Initialize an empty list for our strings
    set_fact:
      updated_vlan_list: []

  - name: Append string to list
    set_fact:
      updated_vlan_list: "{{ updated_vlan_list }} + [ '{{ item.id }}' ]"
    with_items: "{{ vlan_data }}"

  - name: Print new vlan list
    debug: var=updated_vlan_list

  - name: GATHER FACTS TO RECORD VLAN LIST ON NODE
    nxos_facts:
      provider: "{{ nxos_provider }}"

  - name: VLAN LIST ON NODE
    debug: var=vlan_list

  - name: Create to-remove vlan list
    set_fact: to_remove_vlan_list="{{ item }}"
    with_items: "{{ updated_vlan_list | difference(vlan_list) }}"

  - name: CURRENT VLAN LIST
    debug: var=to_remove_vlan_list